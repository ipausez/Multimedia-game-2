<!DOCTYPE HTML>
<html lang="en-US">

<head>
    <meta charset="UTF-8">
    <title>space</title>
    <script type="text/javascript" src="simpleGame.js"></script>
    <style>
        /* ✅ ปรับขนาดให้เต็มจอ */
        body,
        html {
            margin: 0;
            padding: 0;
            overflow: hidden;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: black;
        }

        /* ✅ คอนเทนเนอร์ของเกม */
        #game-container {
            position: relative;
            width: 1280px;
            height: 720px;
            overflow: hidden;
        }

        /* ✅ ให้ Canvas อยู่บนพื้นหลัง */
        canvas {
            position: absolute;
            top: 0;
            left: 0;
        }

        #start-btn {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 15px 30px;
            font-size: 18px;
            background-color: #008CBA;
            color: white;
            border: none;
            cursor: pointer;
        }

        #start-btn:hover {
            background-color: #005f73;
        }
    </style>
</head>

<body>

    <div id="game-container"></div>
    <button id="start-btn">Start Game</button>

    <script type="text/javascript">
        var ship;
        var game;
        var enemies = [];
        var bullets = [];
        var enemyBullets = []; // เก็บกระสุนของศัตรู
        var frameCount = 0;
        let dragonFrames = [
            "enemy/dragon/frame_1.png",
            "enemy/dragon/frame_2.png",
            "enemy/dragon/frame_3.png",
            "enemy/dragon/frame_4.png"
        ];
        var backgroundMusic;
        var isMusicPlaying = false;

        // โหลดรูปหัวใจสำหรับแสดงสุขภาพ
        var heartImage = new Image();
        heartImage.src = "Heart.png";
        var blackHeartImage = new Image();
        blackHeartImage.src = "blackHeart.png";

        var playerHealth = 3; // ผู้เล่นมีหัวใจ 3 ดวง
        var invincible = false; // สถานะป้องกัน
        let blinkCount = 0; // ตัวแปรสำหรับนับจำนวนการกระพริบ
        let blinkInterval;  // ตัวแปรเก็บการกระพริบเพื่อหยุดมัน

        // เพิ่มตัวแปรสำหรับเก็บ medkit
        var medkits = [];

        // ตรวจสอบเมื่อมีการคลิกปุ่ม
        document.getElementById('start-btn').addEventListener('click', function () {
            console.log('Start Game button clicked'); // เช็คว่าเหตุการณ์ถูกเรียก
            playMusic(); // เริ่มเพลง
            init(); // เริ่มเกม
        });

        function Spaceship() {
            let flyImages = ["player/Fly (1).png", "player/Fly (2).png"];
            let shootImages = [
                "player/Shoot (1).png", "player/Shoot (2).png",
                "player/Shoot (3).png", "player/Shoot (4).png",
                "player/Shoot (5).png"
            ];
            let currentFrame = 0;
            let isShooting = false;

            tShip = new Sprite(game, flyImages[currentFrame], 80, 55);
            tShip.setSpeed(0);
            tShip.setImgAngle(90);
            tShip.setPosition(game.width / 6, game.height / 2);

            tShip.checkKeys = function () {
                if (keysDown[65]) this.setX(this.x - 6);
                if (keysDown[68]) this.setX(this.x + 6);
                if (keysDown[87]) this.setY(this.y - 6);
                if (keysDown[83]) this.setY(this.y + 6);

                // ยิงกระสุน
                if (keysDown[32]) {
                    isShooting = true;
                    if (frameCount % 5 === 0) {
                        shootBullet();
                    }
                } else {
                    isShooting = false;
                }

                this.setX(Math.max(50, Math.min(this.x, game.width - 50)));
                this.setY(Math.max(50, Math.min(this.y, game.height - 50)));
            };

            tShip.animate = function () {
                if (isShooting) {
                    let frameIndex = Math.floor(frameCount / 5) % shootImages.length;
                    this.image.src = (shootImages[frameIndex]);
                } else {
                    if (frameCount % 10 === 0) {
                        currentFrame = (currentFrame + 1) % flyImages.length;
                        this.image.src = (flyImages[currentFrame]);
                    }
                }
            };

            return tShip;
        }

        class Dragon {
            constructor(x, y, speed) {
                this.sprite = new Sprite(game, "enemy/flying_dragon-red.png", 191, 161);
                this.sprite.setSpeed(0);
                this.sprite.setPosition(x, y);
                this.speed = 2;
                this.frameIndex = 0;
                this.framesX = 3;
                this.framesY = 4;
                this.frameWidth = 191;
                this.frameHeight = 161;
                this.totalFrames = this.framesX * this.framesY;
                this.direction = 0;
            }

            update() {
                this.move();
                this.animate();
                this.checkCollisionWithPlayer();
            }

            move() {
                let dx = ship.x - this.sprite.x;
                let dy = ship.y - this.sprite.y;
                let angle = Math.atan2(dy, dx);

                this.sprite.setX(this.sprite.x + Math.cos(angle) * this.speed);
                this.sprite.setY(this.sprite.y + Math.sin(angle) * this.speed);

                if (Math.abs(dx) > Math.abs(dy)) {
                    this.direction = dx > 0 ? 1 : 3;
                } else {
                    this.direction = dy < 0 ? 0 : 2;
                }
            }

            animate() {
                if (frameCount % 5 === 0) {
                    this.frameIndex = (this.frameIndex + 1) % this.framesX;
                }

                let frameX = this.frameIndex * this.frameWidth;
                let frameY = this.direction * this.frameHeight;

                game.context.drawImage(
                    this.sprite.image,
                    frameX, frameY,
                    this.frameWidth, this.frameHeight,
                    this.sprite.x - this.frameWidth / 2, this.sprite.y - this.frameHeight / 2,
                    this.frameWidth, this.frameHeight
                );
            }

            // ฟังก์ชันตรวจจับการชนกับผู้เล่น (แยกจากการตรวจจับของศัตรูอื่น)
            checkCollisionWithPlayer() {
                let distance = distanceBetween(this.sprite, ship); // คำนวณระยะห่างระหว่างมังกรกับผู้เล่น

                if (distance < 50) {  // ตรวจสอบระยะห่างที่ต้องการ (เช่น 50px)
                    playerHealth = 0;  // ลดเลือดผู้เล่น
                    invincible = true;  // ทำให้ผู้เล่น invincible เพื่อป้องกันการชนซ้ำ
                    setTimeout(() => { invincible = false; }, 1000);  // ตั้งเวลา invincible 1 วินาที
                    console.log('Dragon collided with player!');

                    // ถ้าเลือดของผู้เล่นหมด
                    if (playerHealth <= 0) {
                        alert("Game Over!"); // แสดงข้อความ Game Over
                        location.reload();  // รีเฟรชเกมใหม่
                    }
                }
            }
        }

        class Bullet {
            constructor(x, y) {
                this.sprite = new Sprite(game, "weapon/machine-gun-bullet.png", 15, 30);
                this.sprite.setSpeed(15);
                this.sprite.setPosition(x, y);
                this.sprite.setImgAngle(180);
                this.sprite.setMoveAngle(90);
            }

            update() {
                this.sprite.update();

                if (this.sprite.x > game.width + this.sprite.width) {
                    let index = bullets.indexOf(this);
                    if (index > -1) {
                        bullets.splice(index, 1);
                    }
                }
            }
        }

        // ยิงกระสุนของผู้เล่น
        function shootBullet() {
            let bullet = new Bullet(ship.x + 20, ship.y + 15);
            bullets.push(bullet);
        }

        // อัปเดตการเคลื่อนที่ของกระสุนของผู้เล่น
        function updateBullets() {
            for (let i = bullets.length - 1; i >= 0; i--) {
                bullets[i].update();

                if (bullets[i].sprite.x > game.width - 30) {
                    bullets.splice(i, 1);
                }
            }
        }

        class EnemyBullet {
            constructor(x, y) {
                this.sprite = new Sprite(game, "weapon/Shot5/shot5_asset.png", 120, 80);
                this.sprite.setSpeed(8);
                this.sprite.setPosition(x, y);
                this.sprite.setImgAngle(270);
                this.sprite.setMoveAngle(270);
            }

            update() {
                this.sprite.update();

                if (this.sprite.x > game.width - this.sprite.width) {
                    let index = enemyBullets.indexOf(this);
                    if (index > -1) {
                        enemyBullets.splice(index, 1);
                    }
                }
            }
        }

        function isAlignedVertically(enemy) {
            let enemyTop = enemy.y - enemy.height / 2;
            let enemyBottom = enemy.y + enemy.height / 2;
            let playerTop = ship.y - ship.height / 2;
            let playerBottom = ship.y + ship.height / 2;

            return (
                (playerTop >= enemyTop && playerTop <= enemyBottom) ||
                (playerBottom >= enemyTop && playerBottom <= enemyBottom) ||
                (enemyTop >= playerTop && enemyBottom <= playerBottom)
            );
        }

        function enemyShootBullet(enemy) {
            if (isAlignedVertically(enemy) && frameCount - enemy.lastShotFrame > enemy.shootDelay) {
                let bullet = new EnemyBullet(enemy.x, enemy.y);
                enemyBullets.push(bullet);
                enemy.lastShotFrame = frameCount;
            }
        }

        function updateEnemyBullets() {
            for (let i = enemyBullets.length - 1; i >= 0; i--) {
                enemyBullets[i].update();
            }
        }

        function Enemy(x, y, type, speed) {
            let e;
            if (type === 3) {
                e = new Dragon(x, y, speed);
            } else {
                let spriteMap = {
                    1: "enemy/enemy-ship.png",
                    2: "enemy/enemy-spaceship.png"
                };
                e = new Sprite(game, spriteMap[type], 50, 50);
                e.setSpeed(0);
                e.setPosition(x, y);
                e.setImgAngle(0);
                e.type = type;
                e.speed = speed;
                e.shootDelay = Math.floor(Math.random() * 100) + 80;
                e.lastShotFrame = 0;
            }

            e.updateBehavior = function () {
                if (this.type === 1) {
                    this.shrinkAndShake();
                    this.setX(this.x - 2);
                } else if (this.type === 2) {
                    this.shrinkAndShake();  // เพิ่มฟังก์ชันสั่นๆ สำหรับประเภท 2
                    enemyShootBullet(this);
                } else if (this.type === 3) {
                    let dx = ship.x - this.x;
                    let dy = ship.y - this.y;
                    let angle = Math.atan2(dy, dx);
                    this.setX(this.x + Math.cos(angle) * 2);
                    this.setY(this.y + Math.sin(angle) * 2);
                }

                if (this.x < -50) {
                    let index = enemies.indexOf(this);
                    if (index > -1) {
                        enemies.splice(index, 1);
                    }
                }
            };

            // ฟังก์ชันทำให้ศัตรูขยับสั่นๆ
            e.shrinkAndShake = function () {
                let shakeX = Math.random() * 4 - 2;  // ขยับในแนว X แบบสุ่ม
                let shakeY = Math.random() * 4 - 2;  // ขยับในแนว Y แบบสุ่ม
                this.setX(this.x + shakeX);  // อัปเดตตำแหน่ง X
                this.setY(this.y + shakeY);  // อัปเดตตำแหน่ง Y
            };

            return e;
        }

        function spawnEnemies(numEnemies) {
            let startX = ship.x + 300;
            let minY = 50;
            let maxY = game.height - 50;
            let xSpacing = 250;
            let ySpacing = 120;
            let maxRows = 4;

            for (let i = 0; i < numEnemies; i++) {
                let col = Math.floor(i / maxRows);
                let row = i % maxRows;

                // ปรับตำแหน่ง x ให้เกิดในพื้นที่ 40% ขึ้นไปของหน้าจอ
                let x = Math.random() * (game.width * 0.6) + (game.width * 0.4); // ทำให้เกิดใน 60% ส่วนหน้าจอที่เหลือ
                let y = minY + row * ySpacing + (Math.random() * 50 - 25);

                let enemyType = Math.floor(Math.random() * 3) + 1;
                let enemySpeed = enemyType === 1 ? Math.random() * 4 + 1 : enemyType === 2 ? 0 : Math.random() * 5 + 3;

                let enemy = new Enemy(x, y, enemyType, enemySpeed);
                enemies.push(enemy);
            }
        }

        // ฟังก์ชันแสดงหัวใจที่มุมซ้ายบนของหน้าจอ
        function drawHealth() {
            const heartWidth = 30;
            const heartHeight = 30;
            const spacing = 10;
            for (let i = 0; i < 3; i++) {
                let img = (i < playerHealth) ? heartImage : blackHeartImage;
                game.context.drawImage(img, spacing + i * (heartWidth + spacing), spacing, heartWidth, heartHeight);
            }
        }

        function blinkEffect() {
            if (invincible) {
                // เริ่มกระพริบเมื่อโดนโจมตี
                if (blinkCount === 0) {
                    blinkCount = 5; // จำนวนการกระพริบ
                    blinkInterval = setInterval(() => {
                        ship.image.src = (ship.image.src.includes("Fly (1)"))
                            ? "player/Fly (2).png"
                            : "player/Fly (1).png"; // สลับภาพระหว่างกระพริบ

                        blinkCount--;
                        if (blinkCount <= 0) {
                            clearInterval(blinkInterval); // หยุดการกระพริบ
                            ship.image.src = "player/Fly (1).png"; // กลับเป็นภาพปกติ
                        }
                    }, 200); // กระพริบทุก 200ms
                }
            } else {
                // ถ้าไม่โดนโจมตีแสดงภาพปกติ
                if (blinkInterval) {
                    clearInterval(blinkInterval);  // หยุดการกระพริบทันที
                }
                ship.image.src = "player/Fly (1).png";  // แสดงภาพปกติ
            }
        }

        // ฟังก์ชันคำนวณระยะห่างระหว่างสองจุด
        function distanceBetween(sprite1, sprite2) {
            let dx = sprite1.x - sprite2.x;
            let dy = sprite1.y - sprite2.y;
            return Math.sqrt(dx * dx + dy * dy);
        }

        // ฟังก์ชันตรวจจับการชนและการสร้าง damage
        function checkCollisions() {
            if (invincible) return; // ไม่ตรวจจับการชนหากผู้เล่นอยู่ในสถานะ invincible

            // ตรวจสอบการชนระหว่างผู้เล่นและศัตรู
            for (let enemy of enemies) {
                let distance = distanceBetween(ship, enemy); // คำนวณระยะห่างระหว่างผู้เล่นและศัตรู

                if (distance < 50) { // ระยะห่างที่กำหนด (50px) คือระยะที่ชนกัน
                    console.log('Collision detected!'); // แสดงในคอนโซลว่าเกิดการชน
                    playerHealth--; // ลดเลือดผู้เล่น
                    invincible = true;
                    setTimeout(() => {
                        invincible = false;
                    }, 1000); // invincible ประมาณ 1 วินาที

                    let index = enemies.indexOf(enemy);
                    if (index > -1) {
                        enemies.splice(index, 1); // ลบศัตรูที่ชนกับผู้เล่น
                    }

                    // กำหนดการกระพริบของผู้เล่นเมื่อโดนชน
                    let blinkCount = 5;
                    let blinkInterval = setInterval(() => {
                        ship.image.src = (ship.image.src.includes("Fly (1)"))
                            ? "player/Fly (2).png"
                            : "player/Fly (1).png";
                        blinkCount--;
                        if (blinkCount <= 0) clearInterval(blinkInterval);
                    }, 200);

                    if (playerHealth <= 0) {
                        alert("Game Over!");
                        location.reload(); // รีเฟรชเกมใหม่
                    }
                    break; // หยุดการตรวจสอบการชนกับศัตรูตัวอื่น
                }
            }
        }

        // ฟังก์ชันตรวจจับการชนระหว่างกระสุนของผู้เล่นกับศัตรู
        function checkBulletEnemyCollisions() {
            for (let i = bullets.length - 1; i >= 0; i--) {
                let bullet = bullets[i];
                for (let j = enemies.length - 1; j >= 0; j--) {
                    let enemy = enemies[j];
                    let enemySprite = enemy.sprite ? enemy.sprite : enemy;

                    // คำนวณระยะห่างระหว่างกระสุนและศัตรู
                    let distance = distanceBetween(bullet.sprite, enemySprite);

                    // ถ้าระยะห่างน้อยกว่าค่าที่กำหนด (เช่น 50px) ก็ถือว่าเกิดการชน
                    if (distance <= 30) {
                        // ลบศัตรูและกระสุน
                        enemies.splice(j, 1);
                        bullets.splice(i, 1);

                        // เรียกฟังก์ชันเมื่อศัตรูถูกกำจัด
                        if (medkits.length === 0) {
                            onEnemyDestroyed();
                        }

                        // สร้างศัตรูใหม่หลังจาก 5 วินาที
                        setTimeout(() => {
                            // สุ่มประเภทของศัตรู (1: เรือ, 2: ยานอวกาศ, 3: มังกร)
                            let enemyType = Math.floor(Math.random() * 3) + 1;

                            // สุ่มตำแหน่งใหม่ที่ไม่ตรงกับตำแหน่งของผู้เล่น
                            let newPos = getRandomPosition();

                            // สร้างศัตรูใหม่ตามประเภทที่สุ่ม
                            let newEnemy = new Enemy(newPos.x, newPos.y, enemyType, Math.random() * 5 + 3);
                            enemies.push(newEnemy);
                        }, 5000); // 5 วินาที (5000 มิลลิวินาที)

                        break;
                    }
                }
            }
        }

        // ฟังก์ชันตรวจจับการชนระหว่างกระสุนศัตรูกับผู้เล่น
        function checkEnemyBulletCollisions() {
            for (let i = enemyBullets.length - 1; i >= 0; i--) {
                let bullet = enemyBullets[i];

                // คำนวณระยะห่างระหว่างกระสุนศัตรูกับผู้เล่น
                let distance = distanceBetween(bullet.sprite, ship);

                // ถ้าระยะห่างน้อยกว่าค่าที่กำหนด (เช่น 50px) ถือว่าเกิดการชน
                if (distance < 50) {
                    // ลดเลือดผู้เล่น
                    playerHealth--;
                    invincible = true;  // ทำให้ผู้เล่น invincible เพื่อไม่ให้โดนโจมตีซ้ำ
                    setTimeout(() => { invincible = false; }, 1000);  // invincible ประมาณ 1 วินาที

                    console.log('Player hit by enemy bullet!');

                    // ลบกระสุนศัตรูออกจากเกม
                    enemyBullets.splice(i, 1);

                    // ถ้าเลือดของผู้เล่นหมด
                    if (playerHealth <= 0) {
                        alert("Game Over!"); // แสดงข้อความ Game Over
                        location.reload();  // รีเฟรชเกมใหม่
                    }
                }
            }
        }

        // ฟังก์ชันสำหรับสุ่มตำแหน่งใหม่
        function getRandomPosition() {
            // ให้ตำแหน่งเกิดอยู่ในครึ่งหลังของหน้าจอ (50% หลังขึ้นไป)
            let spawnX = Math.random() * (game.width / 2) + game.width / 2; // สุ่มจากครึ่งหลังของหน้าจอ
            let spawnY = Math.random() * game.height;  // สุ่มตำแหน่ง y ในระยะทั้งหมดของหน้าจอ

            // ตรวจสอบไม่ให้ศัตรูเกิดเกินขอบหน้าจอ
            spawnX = Math.max(50, Math.min(spawnX, game.width - 50));
            spawnY = Math.max(50, Math.min(spawnY, game.height - 50));

            // พยายามหลีกเลี่ยงการเกิดที่ใกล้เกินไปจากผู้เล่น
            // ใช้ระยะห่างขั้นต่ำ 200px จากผู้เล่นทั้งในแกน X และ Y
            while (Math.abs(spawnX - ship.x) < 200 || Math.abs(spawnY - ship.y) < 200) {
                spawnX = Math.random() * (game.width / 2) + game.width / 2; // สุ่มใหม่
                spawnY = Math.random() * game.height; // สุ่มใหม่
            }

            return { x: spawnX, y: spawnY };
        }

        // สุ่มตำแหน่งของ medkit
        function spawnMedkit() {
            let spawnX = Math.random() * (game.width / 2) + game.width / 2; // สุ่มจากครึ่งหลังของหน้าจอ
            let spawnY = Math.random() * game.height;  // สุ่มตำแหน่ง y ในระยะทั้งหมดของหน้าจอ

            // ตรวจสอบไม่ให้ medkit เกิดทับตำแหน่งผู้เล่น
            while (Math.abs(spawnX - ship.x) < 200 || Math.abs(spawnY - ship.y) < 200) {
                spawnX = Math.random() * (game.width / 2) + game.width / 2;
                spawnY = Math.random() * game.height;
            }

            let newMedkit = new Sprite(game, "medkit.png", 50, 50);  // ใช้ medkit ที่เราเตรียม
            newMedkit.setSpeed(0);  // ตั้งความเร็วเป็น 0
            newMedkit.setPosition(spawnX, spawnY);  // ตั้งตำแหน่งที่สุ่ม
            medkits.push(newMedkit);  // เพิ่ม medkit ที่เกิดใหม่เข้าใน array
        }

        // ฟังก์ชันตรวจจับการชนระหว่าง medkit กับผู้เล่น
        function checkMedkitCollision() {
            for (let i = 0; i < medkits.length; i++) {
                let medkit = medkits[i];
                let distance = distanceBetween(medkit, ship); // คำนวณระยะห่างระหว่าง medkit กับผู้เล่น

                if (distance < 50) {  // ถ้าห่างกันน้อยกว่า 50px (ขนาดของ medkit)
                    if (playerHealth < 3) {  // ถ้าเลือดผู้เล่นยังไม่เต็ม
                        playerHealth++;  // เพิ่มเลือดให้ผู้เล่น
                        medkits.splice(i, 1);  // ลบ medkit ออกจากเกม
                        console.log("Medkit collected, health increased");
                    } else {
                        console.log("Health is full, medkit cannot be collected");
                    }
                    break;  // หยุดการตรวจจับการชน
                }
            }
        }

        // ฟังก์ชันที่จะถูกเรียกเมื่อกำจัดศัตรูครบ 10 ตัว
        function onEnemyDestroyed() {
            if (enemies.length % 10 === 0) {
                spawnMedkit();  // สร้าง medkit ทุกครั้งที่กำจัดศัตรูครบ 10 ตัว
            }
        }

        // ฟังก์ชันเริ่มต้นเล่นเพลง
        function playMusic() {
            console.log('Playing music...');
            if (!isMusicPlaying) {
                backgroundMusic = new Sound('other-assets/sounds/jetpack-joyride-theme.mp3');
                backgroundMusic.snd.volume = 0.1; // ปรับระดับเสียงเป็น 50% (คุณสามารถปรับค่าเป็น 0-1)
                backgroundMusic.snd.loop = true; // ตั้งให้เพลงเล่นวนลูป
                backgroundMusic.play();
                isMusicPlaying = true;
                document.getElementById('start-btn').style.display = 'none'; // ซ่อนปุ่มเริ่มเกมหลังจากคลิก
            }
        }

        function init() {
            console.log('Game initialization...');
            game = new Scene();
            game.setSize(1280, 720);

            game.backgroundVideo = document.createElement("video");
            game.backgroundVideo.src = "background-video.mp4";
            game.backgroundVideo.autoplay = true;
            game.backgroundVideo.loop = true;
            game.backgroundVideo.muted = true;
            game.backgroundVideo.play();

            document.getElementById("game-container").appendChild(game.canvas);

            ship = new Spaceship();

            spawnEnemies(20);

            game.start();
        }

        function update() {
            game.clear();
            game.context.drawImage(game.backgroundVideo, 0, 0, game.width, game.height);

            // ตรวจสอบการชนระหว่างกระสุนของผู้เล่นและศัตรู
            checkBulletEnemyCollisions(); // ควรตรวจสอบการชนกับกระสุนก่อน

            // ตรวจสอบการชนระหว่างกระสุนศัตรูและผู้เล่น
            checkEnemyBulletCollisions(); // ตรวจจับการชนของกระสุนศัตรูกับผู้เล่น

            // ตรวจจับการชนระหว่างผู้เล่นและศัตรู (รวมถึงมังกร)
            checkCollisions();

            // ตรวจสอบการชนระหว่าง medkit กับผู้เล่น
            checkMedkitCollision();

            // อัปเดตการเคลื่อนที่ของผู้เล่น
            ship.checkKeys();
            ship.animate();
            ship.update();

            // อัปเดตการเคลื่อนที่ของกระสุนของผู้เล่นและศัตรู
            updateBullets();
            updateEnemyBullets();

            // อัปเดตการเคลื่อนที่ของศัตรู
            for (let enemy of enemies) {
                enemy.updateBehavior();
                enemy.update();
            }

            // วาด medkit
            for (let medkit of medkits) {
                medkit.update();  // อัปเดตตำแหน่ง medkit
                game.context.drawImage(medkit.image, medkit.x - medkit.width / 2, medkit.y - medkit.height / 2, medkit.width, medkit.height);
            }

            drawHealth(); // วาดสถานะหัวใจของผู้เล่น
            // blinkEffect(); // ฟังก์ชันกระพริบเมื่อผู้เล่นโดนโจมตี

            frameCount++;
        }
    </script>
</body>

</html>